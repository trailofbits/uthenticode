<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>uthenticode: uthenticode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">uthenticode
   &#160;<span id="projectnumber">1.0.9-3a91122</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">uthenticode </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://github.com/trailofbits/uthenticode/actions?query=workflow%3ACI"><img src="https://img.shields.io/github/workflow/status/trailofbits/uthenticode/CI/master" alt="Build Status" class="inline"/></a></p>
<p><em>uthenticode</em> (stylized as <em>μthenticode</em>) is a small cross-platform library for verifying <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/install/authenticode">Authenticode</a> digital signatures.</p>
<p><a href="https://blog.trailofbits.com/2020/05/27/verifying-windows-binaries-without-windows/">Read our blog post on verifying Windows binaries without Windows!</a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
What?</h1>
<p>Authenticode is Microsoft's code signing technology, designed to allow signing and verification of programs.</p>
<p><em>μthenticode</em> is a cross-platform reimplementation of the verification side of Authenticode. It doesn't attempt to provide the signing side.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Why?</h1>
<p>Because the official APIs (namely, the <code>Wintrust</code> API) for interacting with Authenticode signatures are baked deeply into Windows, making it difficult to verify signed Windows executables on non-Windows hosts.</p>
<p>Other available solutions are deficient:</p>
<ul>
<li>WINE implements most of <code>Wintrust</code>, but is a massive (and arguably non-native) dependency for a single task.</li>
<li><a href="https://github.com/mtrojnar/osslsigncode"><code>osslsigncode</code></a> can add signatures and check timestamps, but is CLI-focused.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Beware!</h1>
<p><em>μthenticode</em> is <b>not</b> identical to the <code>Wintrust</code> API. Crucially, it <b>cannot</b> perform full-chain verifications of Authenticode signatures, as it lacks access to the Trusted Publishers store.</p>
<p>You should use <em>μthenticode</em> to verify the embedded chain. You should <b>not</b> assume that a "verified" binary from <em>μthenticode</em>'s perspective will run on an unmodified Windows system.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Building</h1>
<p><em>μthenticode</em> depends on <a href="https://github.com/trailofbits/pe-parse">pe-parse</a> and OpenSSL 1.1.0.</p>
<p>pe-parse (and OpenSSL, if you don't already have it) can be installed via <code>vcpkg</code>:</p>
<div class="fragment"><div class="line">$ vcpkg install pe-parse</div>
</div><!-- fragment --><p>The rest of the build is standard CMake:</p>
<div class="fragment"><div class="line">$ mkdir build &amp;&amp; cd build</div>
<div class="line">$ cmake ..</div>
<div class="line">$ cmake --build .</div>
<div class="line"># the default install prefix is the build directory;</div>
<div class="line"># use CMAKE_INSTALL_PREFIX to modify it</div>
<div class="line">$ cmake --build . --target install</div>
</div><!-- fragment --><p>If you have <code>doxygen</code> installed, you can build <em>μthenticode</em>'s documentation with the top-level <code>Makefile</code>:</p>
<div class="fragment"><div class="line">$ make doc</div>
</div><!-- fragment --><p>Pre-built (master) documentation is hosted <a href="https://trailofbits.github.io/uthenticode/">here</a>.</p>
<p>You can build the (gtest-based) unit tests with <code>-DBUILD_TESTS=1</code>.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Usage</h1>
<p><em>μthenticode</em>'s public API is documented in <code><a class="el" href="uthenticode_8h.html">uthenticode.h</a></code> and in the Doxygen documentation (see above).</p>
<p>The <code>svcli</code> utility also provides a small example of using <em>μthenticode</em>'s APIs. You can build it by passing <code>-DBUILD_SVCLI=1</code> to <code>cmake</code>:</p>
<div class="fragment"><div class="line">$ cmake -DBUILD_SVCLI=1 ..</div>
<div class="line">$ cmake --build .</div>
<div class="line">$ ./src/svcli/svcli /path/to/some.exe</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Resources</h1>
<p>The following resources were essential to <em>uthenticode</em>'s development:</p>
<ul>
<li>The <a href="https://github.com/mtrojnar/osslsigncode"><code>osslsigncode</code></a> codebase</li>
<li>ClamAV's <a href="https://www.clamav.net/documents/microsoft-authenticode-signature-verification">Authenticode documentation</a></li>
<li>Microsoft's <a href="http://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx">Authenticode specification</a> (circa 2008)</li>
<li>Peter Gutmann's <a href="https://www.cs.auckland.ac.nz/~pgut001/pubs/authenticode.txt">Authenticode format notes</a></li>
<li><a href="https://tools.ietf.org/html/rfc5652">RFC5652</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
